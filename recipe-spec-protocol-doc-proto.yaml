version: "1.0.0"
title: "要件固め→spec/protocol/docs/proto を完成させる"
description: "対話で要件を固め、spec.md / protocol.md / docs/ / proto/ を整合して完成させる。最後に just ci。"
extensions:
  - type: builtin
    name: developer
    bundled: true
    description: "Read/write files and run commands in the repo."
instructions: |
  目的: ユーザと対話して要件を確定し、`spec.md` / `protocol.md` / `docs/` / `proto/` を整合して完成させる。

  前提:
  - 仕様の正は `spec.md`。
  - 不明点は推測せず質問して確定する。
  - developer tool（ファイル操作・コマンド実行）で必ず実リポジトリを確認して進める。

  手順:
  1) まず `AGENTS.md` と `.codex/skills/`（特に spec/design）と既存 `spec.md` / `docs/` / `proto/` を読む。
  2) ユーザに質問して「ゴール/受入条件/用語/スコープ/制約」を確定し、要件サマリを提示して合意を取る。
  3) 合意した内容で `spec.md` を更新する（Concept + Sync 形式）。
  4) `protocol.md` を作成/更新し、proto との対応と互換性方針を明記する。
  5) `proto/` を AIP + google.api.http + Protovalidate 前提で更新する（buf fmt/lint を通す）。
  6) `docs/` に導線と使い方を追加し、必要なら `docs/docs.json` を更新する。
  7) 最後に `just ci`（または `nix develop -c just ci`）を通るまで直す。
prompt: |
  これから要件を固めて、spec.md / protocol.md / docs/ / proto/ を整合した状態で完成させます。

  まず次を教えてください:
  1) ゴール（1〜2文）
  2) 想定する利用者（人/システム）とユースケース
  3) 既存の API / 既存の proto があるか（あれば概要）
  4) 絶対に守りたい制約（互換性・期限・運用・セキュリティなど）
activities:
  - "要件ヒアリングを開始する"
  - "spec.md / proto/ / docs/ を確認する"
  - "spec.md を更新する"
  - "protocol.md を作成する"
  - "proto/ を更新する"
  - "docs/ を更新する"
  - "just ci を通す"
