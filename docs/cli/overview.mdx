---
title: CLI Overview
description: Commands and the end-to-end workflow.
---

Sitebookify is a CLI-only tool (MVP).

## Compile and run from source

```sh
nix develop -c cargo build --release
./target/release/sitebookify --help
```

If you want to run via Cargo:

```sh
nix develop -c cargo run -- crawl --url https://example.com/docs/ --out raw
```

## Workflow

The typical workflow is:

0. `build` (one-shot: runs everything into a workspace directory)
1. `crawl` (Raw snapshot)
2. `extract` (Extracted Pages snapshot)
3. `manifest` (JSONL index)
4. `toc init` (YAML chapter layout)
5. `toc refine` (optional: reorder/omit pages + title via LLM)
6. `llm rewrite-pages` (optional: rewrite pages into book-first prose)
7. `book init` (mdBook skeleton)
8. `book render` (generate `book/src/`)
9. `book bundle` (single Markdown file + assets)

## Commands

### `build`

Run the full pipeline (crawl → extract → manifest → toc (init/refine) → (optional) rewrite-pages → book (init/render) → bundle) in one command.

```sh
sitebookify build \
  --url https://example.com/docs/ \
  --out workspace
# --title is optional (derived from toc.yaml / LLM)
```

Workspace layout (MVP):

```text
<out>/
  raw/
  extracted/
  manuscript/               # optional (created when rewrite is enabled)
  manifest.jsonl
  manifest.manuscript.jsonl # optional (created when rewrite is enabled)
  toc.yaml
  book/
  assets/
  book.md
```

Notes (MVP):

- Workspaces are write-once: if `--out` already exists, `build` fails.
- Crawl flags (`--max-pages`, `--max-depth`, `--concurrency`, `--delay-ms`) are supported.
- If `--toc-refine` is set, the LLM may reorder/omit pages and propose a better title.
- If `--rewrite-prompt <TEXT>` is set, `build` rewrites TOC-selected pages into `manuscript/` and renders the book from it.
  - `OPENAI_API_KEY` is required when `--rewrite-engine openai` is used.

### `crawl`

Fetch pages under the start URL and save HTML into a Raw snapshot directory.

```sh
sitebookify crawl \
  --url https://example.com/docs/ \
  --out raw
```

Notes (MVP):

- URL normalization removes query strings (`?...`), fragments (`#...`), and trailing slashes (except `/`).
- Only the same origin and the start path subtree are crawled.
- Only `text/html` responses are saved as Raw HTML.
- Raw snapshots are write-once: if `--out` already exists, `crawl` fails.
- Crawling uses `spider` (spider-rs).

Main flags:

- `--max-pages` (default: 200)
- `--max-depth` (default: 8)
- `--concurrency` (default: 4)
- `--delay-ms` (default: 200)

### `extract`

Convert Raw HTML files into Extracted Pages (Markdown with YAML front matter).

```sh
sitebookify extract --raw raw --out extracted
```

Notes (MVP):

- Extracted snapshots are write-once: if `--out` already exists, `extract` fails.
- Main content extraction uses Mozilla Readability (Firefox Reader Mode) via `readability-js`.

### `manifest`

Build `manifest.jsonl` from `extracted/pages/*.md`.

```sh
sitebookify manifest --extracted extracted --out manifest.jsonl
```

### `toc init`

Generate an initial `toc.yaml` from `manifest.jsonl`.

```sh
sitebookify toc init --manifest manifest.jsonl --out toc.yaml
```

If you want to override the generated book title:

```sh
sitebookify toc init --manifest manifest.jsonl --out toc.yaml --book-title "My Book"
```

### `toc refine` (optional)

Refine reading order (and optionally omit pages) via an LLM.

```sh
sitebookify toc refine --manifest manifest.jsonl --out toc.refined.yaml --engine openai
```

### `llm rewrite-pages` (optional)

Rewrite TOC-selected pages into book-first prose (mostly text).

```sh
sitebookify llm rewrite-pages \
  --toc toc.yaml \
  --manifest manifest.jsonl \
  --out manuscript \
  --prompt "Summarize concisely in Japanese." \
  --engine openai
```

### `book init`

Create an mdBook skeleton.

```sh
sitebookify book init --out book --title "Example Docs Textbook"
```

### `book render`

Render chapters based on `toc.yaml` and `manifest.jsonl`.

```sh
sitebookify book render --toc toc.yaml --manifest manifest.jsonl --out book
```

Notes (MVP):

- `book/` is treated as generated output.
- Every generated chapter includes a `## Sources` section.
